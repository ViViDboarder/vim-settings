" Vundle
filetype off                   " required!

set rtp+=~/.vim/bundle/vundle/
call vundle#rc()

" let Vundle manage Vundle
" required!
Bundle 'gmarik/vundle'

" Rest of my bundles

" -- File Nav --
" Quick find files in project
Bundle 'kien/ctrlp.vim'
" File tree navigation
Bundle 'scrooloose/nerdtree'
" Switch to alternate file
Bundle 'a.vim'
" Allow opening to a line from file name using :
Bundle 'file-line'
" Git integration
Bundle 'tpope/vim-fugitive'
" Needs Vim compiled with Ruby
" Quick find files in project
Bundle 'wincent/Command-T' 

" -- Buffer Nav --
" Tree view for managing tabs
"Bundle 'kien/tabman.vim'
" Quick buffer switching
Bundle 'sandeepcr529/Buffet.vim'
" Needs Vim compiled with Ruby
" Buffer toggler
"Bundle 'mutewinter/LustyJuggler'

" -- Nav in file --
" Ctags file parsing
Bundle 'taglist.vim'
" Syntax checking
Bundle 'scrooloose/syntastic'
" Project Searching
Bundle 'mileszs/ack.vim'
" Easy Toggle of QuickFix window
Bundle 'ViViDboarder/QFixToggle'

" -- Text Manipulation --
" Easy comments
Bundle 'tomtom/tcomment_vim'
" Surround for wrapping text
Bundle 'tpope/vim-surround'
" Multi cursor
Bundle 'terryma/vim-multiple-cursors'

" -- GUI --
Bundle 'vividchalk.vim'
" Can probably drop this for wombat256
Bundle 'vim-scripts/Wombat' 
Bundle 'wombat256.vim'
Bundle 'gregsexton/MatchTag'
" Custom Status Line
Bundle 'Lokaltog/vim-powerline'
"Powerline Config
"If using a patched font: https://github.com/Lokaltog/vim-powerline/wiki/Patched-fonts 
"let g:Powerline_symbols = 'fancy'

" -- Filetypes --
Bundle 'ViViDboarder/vim-forcedotcom'
Bundle 'pdurbin/vim-tsv'

"Allow arrow keys
set nocompatible

"Use more convenient leader
let mapleader=","

"Enable mouse input
set mousehide
set mouse=a

"tab functionality
"tabs inserted as 4 spaces
"backspace deletes all spaces
"autoindent enabled
set expandtab
set tabstop=4
set shiftwidth=4
set softtabstop=4
set autoindent
"Ensure backspace actually works
set backspace=2
filetype plugin indent on

set virtualedit=onemore 	   	" allow for cursor beyond last character
set scrolljump=5 				" lines to scroll when cursor leaves screen
set scrolloff=3 				" minimum lines to keep above and below cursor

" Display filename at bottom of window
set ls=2

"Set backup dirs
set backup
set backupdir=~/.vim/backup
set directory=~/.vim/tmp

"set theme based on $VIM_COLOR variable
try
    if !empty($VIM_COLOR)
        colorscheme $VIM_COLOR
    else
        if has("gui_running")
            colorscheme wombat
        else
            colorscheme vividchalk
        endif
    endif
catch /^Vim\%((\a\+)\)\=:E185/
        " Colorschemes not installed yet
        " This happens when first installing bundles
endtry

"Highlights the line the cursor is on
set cursorline
:hi CursorLine   cterm=NONE ctermbg=darkred guibg=darkred guifg=white
"Toggle highlighting with \hr (highlight row)
nnoremap <leader>hr :set cursorline!<CR>

if has("gui_win32")       
	set guifont=Consolas:h10:b
endif

"enable line numbers
set nu

"Toggle Line numbers with Ctrl+N double tap
nmap <C-N><C-N> :set invnumber<CR>
nmap <leader>ln :set invnumber<CR>

"Toggle line wrap with Ctrl+L double tap
nmap <C-L><C-L> :set wrap!<CR>
nmap <leader>lw :set wrap!<CR>

"Toggle White Space
nmap <leader>ws :set list!<CR>

"Allows filetype detection
filetype on

"Move between splits using Ctrl+hjkl
"map <C-k> <C-w>k
"map <C-j> <C-w>j
"map <C-l> <C-w>l
"map <C-h> <C-w>h

"map Shift+U to redo
nnoremap <S-u> <C-r> 

"Buffet shortcut
nnoremap <silent> <F2> :Bufferlist<CR>
nnoremap <leader>bl :Bufferlist<CR>

"Tab Man shortcut
"nnoremap <silent> <F3> :TMToggle<CR>

"LustyJugler settings
"let g:LustyJugglerShowKeys=1 "Show numbers for Lusty Buffers
"let g:LustyJugglerSuppressRubyWarning=1
"nnoremap <silent> <C-L><C-J> :LustyJuggler<CR>
"nnoremap <leader>. :LustyJugglePrevious<CR>

"NERDTree
nnoremap <silent> <F4> :NERDTreeToggle<CR>
nnoremap <leader>nn :NERDTreeToggle<CR>
nnoremap <leader>nf :NERDTreeFind<CR>

"NERDComments
nnoremap // :TComment<CR>
vnoremap // :TCommentBlock<CR>

"CTags List
"nnoremap <silent> <F8> :TlistToggle<CR>
"let Tlist_Exit_OnlyWindow=1
"let Tlist_Winwidth=30
nnoremap <silent> <F8> :TagbarToggle<CR>

"Syntax Hightlighting
syntax on

"Remap jk to esc
inoremap jk <esc>
"vnoremap jk <esc> "Makes it difficult to select lines as j is common

"Remap Ctrl+Space for auto Complete
inoremap <C-Space> <C-n>
inoremap <Nul> <C-n>

" Stupid shift key fixes
"cmap W w
cmap WQ<CR> wq<CR>
cmap Wq<CR> wq<CR>
cmap W<CR> w<CR>
cmap Q<CR> q<CR>

"Enable search highlighting
set hls
"clearing highlighted search
nmap <silent> <leader>/ :set hlsearch! hlsearch?<CR>
noremap <C-h><C-s> :set hlsearch! hlsearch?<CR>

" Change Working Directory to that of the current file
cmap cwd lcd %:p:h
cmap cd. lcd %:p:h

" ---------------
" Command T and ctrlp.vim
" Snagged from mutewinter @ https://github.com/mutewinter/dot_vim
" ---------------
" Ensure Ctrl-P isn't bound by default
let g:ctrlp_map = ''

" Ensure max height isn't too large. (for performance)
let g:ctrlp_max_height = 10
let g:CommandTMaxHeight = 10

" Set the default escape keybinding to, you guessed it, escape.
let g:CommandTCancelMap = '<esc>'

" Dynamically use Command T or ctrlp.vim based on availability of Ruby.
" We do this because Command T is much faster than ctrlp.vim.
if has('ruby')
  " --------
  " Use Command T since we've got Ruby
  " --------

  " Conditional Mappings
  if has('unix')
    nnoremap <silent><C-t> :CommandT<CR>
    nnoremap <C-r><C-t> :CommandTFlush<CR>
  else
    nnoremap <silent><M-t> :CommandT<CR>
    nnoremap <M-r><M-t> :CommandTFlush<CR>
  endif

  " Leader Commands
  nnoremap <leader>t :CommandT<CR>
  nnoremap <leader>tb :CommandTBuffer<CR>
  nnoremap <leader>tt :CommandTTag<CR>

  if has("gui_macvim")
      "macmenu &File.New\ Tab key=<nop>
      "map <D-t> :CommandT<CR>
  endif
else
  " --------
  " Use ctrlp.vim since we don't have Ruby
  " --------

  " Conditional Mappings
  if has('unix')
    let g:ctrlp_map = '<C-t>'
  else
    let g:ctrlp_map = '<M-t>'
  endif

  " Leader Commands
  "nnoremap <leader>t :CtrlPRoot<CR>
  nnoremap <leader>b :CtrlPBuffer<CR>
endif

" Also map leader commands
nnoremap <leader>u :CtrlPCurFile<CR>
nnoremap <leader>m :CtrlPMRUFiles<CR>

" Add some shortcuts for git commands
nnoremap <leader>gs :Gstatus<CR>
nnoremap <leader>gc :Gcommit<CR>
nnoremap <leader>gb :Gblame<CR>

" Bind Make to F5 like other IDEs
nnoremap <F5> :make<CR>

" Toggle QuickFix window
nnoremap <silent> <F6> :QFix<CR>

nmap <leader>a :Ack<Space>
nmap <leader>* :Ack<Space><c-r><c-W><CR>
"nnoremap ** :Ack<Space><c-r><c-W><CR>

